name: Scheduled Mutation Testing

on:
  schedule:
    - cron: '0 0 * * *' # Daily at midnight
  workflow_dispatch: # Allow manual trigger

jobs:
  backend-mutation:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
    - name: Set up JDK 21
      uses: actions/setup-java@3a4f6e1af504cf6a31855fa899c6aa5355ba6c12 # v4.7.0
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: maven
    - name: Run Pitest (Full)
      run: |
        cd backend
        chmod +x mvnw
        sed -i 's/\r$//' mvnw
        ./mvnw test-compile pitest:mutationCoverage -B
    - name: Upload Pitest Report
      if: always()
      uses: actions/upload-artifact@4cec3d8aa04e39d1a68397de0c4cd6fb9dce8ec1 # v4.6.1
      with:
        name: pitest-full-report
        path: backend/target/pit-reports

  frontend-mutation:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
    - name: Set up Node.js
      uses: actions/setup-node@1d0ff469b7ec7b3cb9d8673fde0c81c44821de2a # v4.2.0
      with:
        node-version: '22'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json
    - name: Install Dependencies
      run: |
        cd frontend
        npm install --legacy-peer-deps
    - name: Run Stryker (Full)
      run: |
        cd frontend
        npm run stryker
    - name: Upload Stryker Report
      if: always()
      uses: actions/upload-artifact@4cec3d8aa04e39d1a68397de0c4cd6fb9dce8ec1 # v4.6.1
      with:
        name: stryker-full-report
        path: frontend/reports/mutation
